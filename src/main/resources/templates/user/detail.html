<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="user/layout/head::head"></div>
    <link rel="stylesheet" th:href="@{../css/chi-tiet-sp.css}" type="text/css">
</head>
<body>
    <div th:replace="user/layout/header :: .container-menu"></div>
    <div th:replace="user/layout/header :: #back-to-top"></div>
    <div class="content">
        <div class="content-page">
            <div class="chitiet">
                <div class="ctsanpham">
                    <p>
                        <a th:href="@{/index}">Trang chủ</a> \
                        <a th:href="@{/filter}">Điện thoại</a> \
                        <a th:href="@{'/detail/'+${product.id}}" th:text="${product.title}"></a>
                    </p>
                    <!-- <h1 class="title">Điện thoại huawei-y5-2017-300x300</h1> -->
                    <!-- <div class="rating">
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star-o"></i>
                        <i class="fa fa-star-o"></i>
                        <span>176 đánh giá</span>
                    </div> -->
                </div>

                <div class="rowdetail group">
                    <div class="picture">
                        <img th:src="@{${url}+${product.avatar}}">
                    </div>
                    <div class="price_sale">
                        <div class="area_price">
                            <h2 class="title" th:text="${product.title}"></h2>
                            <p class="price" style="font-size: 25px; padding: 5px 0px;" th:text="${#numbers.formatInteger(product.discount,3,'POINT')}+' VNĐ'"></p>
                        </div>
                        <div class="area_promo">
                            <strong>Khuyến mãi</strong>
                            <div class="promo">
                                <img th:src="@{../img/images/icon-tick.png}" alt="">
                                <div class="detailPromo"><p style="margin: 0px;">Khách hàng có thể mua trả góp sản phẩm với lãi suất 0% với thời hạn 6 tháng kể từ khi mua hàng.</p></div>
                            </div>
                            <div class="promo">
                                <img th:src="@{../img/images/icon-tick.png}" alt="">
                                <div class="detailPromo"><p style="margin: 0px;">Giảm giá 5% khi mua phụ kiện.</p></div>
                            </div>
                            <div class="promo">
                                <img th:src="@{../img/images/icon-tick.png}" alt="">
                                <div class="detailPromo"><p style="margin: 0px;">Thu cũ đổi mới: Giá thu cao - Thủ tục nhanh chóng - Trợ giá tốt nhất.</p></div>
                            </div>
                        </div>
                        <div class="policy">
                            <div>
                                <img th:src="@{../img/images/box.png}" alt="">
                                <p>Bộ sản phẩm gồm: Hộp, Sách hướng dẫn, Cây lấy sim, Củ sạc nhanh rời đầu Type A, Cáp Type C</p>
                            </div>
                            <div>
                                <img th:src="@{../img/images/icon-baohanh.png}" alt="">
                                <p>Bảo hành chính hãng 12 tháng</p>
                            </div>
                            <div class="last">
                                <img th:src="@{../img/images/1-1.jpg}" alt="">
                                <p>1 đổi 1 trong 1 tháng nếu lỗi, đổi trong vòng 1 ngày hoặc đổi tại cửa hàng</p>
                            </div>
                        </div>
                        <div class="area_order">
                            <button class="btn-add" th:onclick="|addMoreCare(-1)|">-</button>
                            <input type="number" name="num" class="form-control" step="1" value="1" th:onchange="|fixCartNum()|">
                            <button class="btn-add" th:onclick="|addMoreCare(1)|">+</button>
                            <button th:onclick="|addCart('${product.id}')|" class="buy_now">
                                <b><i class="fa fa-cart-plus"></i> Thêm vào giỏ hàng</b>
                            </button>
                        </div>
                    </div>
                    <div class="info_product">
                        <h2>Thông số kỹ thuật</h2>
                        <ul class="info">
                            <li>
                                <p>Màn hình: </p>
                                <span th:text="${product.KTmanHinh}+' inch'"></span>
                            </li>
                            <li>
                                <p>Camera trước: </p>
                                <span th:text="${product.cameraTruoc}+' MP'"></span>
                            </li>
                            <li>
                                <p>Camera sau: </p>
                                <span th:text="${product.cameraSau}+' MP'"></span>
                            </li>
                            <li>
                                <p>CPU: </p>
                                <span th:text="${product.CPU}"></span>
                            </li>
                            <li>
                                <p>RAM: </p>
                                <span th:text="${product.ram}+' GB'"></span>
                            </li>
                            <li>
                                <p>Bộ nhớ trong: </p>
                                <span th:text="${product.rom}+' GB'"></span>
                            </li>
                            <li>
                                <p>Dung lượng pin: </p>
                                <span th:text="${product.pin}+' mAh'"></span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="box-border">
                <div class="rate">
                    <h2 class="rating_title">Đánh giá sản phẩm</h2>
                    <div class="rating-star left">

                        <div class="rating-list">
                            <div class="rating-comment">
                                <div class="rating-comment-product">
                                    <div id="commentBox">

                                    </div>
                                    <div class="comment-all" th:each="cmt:${comments}">
                                        <div class="comment-item">
                                            <div class="item-top">
                                                <p class="txtname" th:text="${cmt.user.username}"></p>
                                            </div>
                                        </div>
                                        <div class="product-rating-time" th:text="${cmt.updated}">

                                        </div>
                                        <div class="comment-content">
                                            <p class="cmt-txt" th:text="${cmt.review}"></p>
                                        </div>
                                        <div class="item-click">
                                            <a href="" class="clicklike">
                                                <i class="fa fa-thumbs-up"></i>
                                                Hữu ích
                                            </a>
                                            <a href="" class="clicklike">
                                                <i class="fa fa-thumbs-down"></i>
                                                Không hữu ích
                                            </a>
                                            <a href="" class="clicklike">
                                                <i class="fa fa-envelope"></i>
                                                Trả lời
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="pagecomment">


                            <th:block th:if="${result.totalPages != 0}" th:each="i : ${#numbers.sequence(0, result.totalPages - 1)}">
                                <a th:if="${i == result.pageNo}" class="active" th:text="${i+1}"></a>
                                <a th:unless="${i == result.pageNo}" class="active1" th:text="${i+1}" th:onclick="'layUrl(\'pageNo\', \'' + ${i} + '\')'"></a>
                            </th:block>
                            <th:block th:if="${result.totalPages == 0}">
                                <a class="active" th:text="${result.pageNo +1}"></a>
                            </th:block>
<!--                            <a href="" class="active1" ></a>-->

                        </div>


                        <div>
                            <th:block th:if="${#authorization.expression('isAuthenticated()')}">
<!--                            <form action="" method="post">-->
                                <textarea id="contentRate" rows="" cols="" name="content" placeholder="   Hãy để lại đánh giá của bạn"
                                          style="width:100%" required></textarea>
                                <br>
                                <p style="text-align: center; font-size: 16px; font-weight: bold;">Bạn nghĩ sao về sản phẩm này?</p>
                                <div style="display: flex; justify-content: center;">
                                    <button type="submit" id="btnSubmit" th:onclick="|addComment('${product.id}')|" >Gửi</button>
                                </div>
<!--                            </form>-->
                            </th:block>
                        </div>

                    </div>
                </div>
            </div>
            <div class="product-list">
                <div class="name-text-container">
                    <p class="name-text">Bạn có thể thích</p>
                </div>
                <div class="product">

                    <div class="card" th:each="pro:${pros}">
                        <div class="product-promo-container">
                            <div class="product-promo">
                                <p> Đề xuất </p>
                            </div>
                        </div>
                        <img th:src="@{${url}+${pro.avatar}}" style="width:100%">
                        <a th:href="@{'/detail/'+${pro.id}}" th:text="${pro.title}"></a>
                        </br>
                        </br>
                        </br>
                        <p class="price" th:text="${#numbers.formatInteger(pro.discount,3,'POINT')}+' VNĐ'"></p>
                        </br>
                        <div class="ratingresult">

<!--                            <i class="fa fa-star"></i>-->

<!--                            <i class="fa fa-star-o"></i>-->

<!--                            <span>76 đánh giá</span>-->
                        </div>

                    </div>


                </div>
            </div>
        </div>
    </div>
<!--    <div class="cart_icon">-->
<!--        <span id="cart" class="cart_count" th:text="${session.totalItems}"></span>-->
<!--        <a th:href="@{/cart}"><img th:src="@{../img/cart.png}"></a>-->
<!--    </div>-->

    <div th:replace="user/layout/footer"></div>
    <div th:replace="user/layout/cart"></div>
    <script th:src="@{../js/category.js}"></script>
    <script th:inline="javascript">
        function addMoreCare(delta){
            num = parseInt($('[name=num]').val())
            num += delta
            if(num < 1) num = 1
            $('[name=num]').val(num)
        }

        function fixCartNum(){
            $('[name=num]').val(Math.abs($('[name=num]').val()))
        }

        function addCart(productId){
            $.ajax({
                type:'POST',
                url:'/ajax/addToCart/' + productId,
                data:{
                    'num':$('[name=num]').val()
                },
                success: function (response) {
                    if (response > 0) {
                        // Hiển thị phần tử cart_item
                        $('.cart_icon').show();
                        // Cập nhật số lượng sản phẩm trong giỏ hàng
                        // $('#cartItemCount').text(response.totalItems);
                    } else {
                        // Nếu không có sản phẩm, ẩn phần tử cart_item
                        $('.cart_icon').hide();
                    }

                    // Cập nhật số lượng sản phẩm trên biểu tượng giỏ hàng chính
                    $('#cart').html(response);
                    // $('#cart').html(response);
                },
                error: function (xhr, status, error) {
                    console.log(xhr.responseText);
                }
            })
        }

        function addComment(id) {
            let contentValue = $('#contentRate').val();
            if (contentValue != null && contentValue.trim() !== '') {
                $.ajax({
                    type: "POST",
                    url: '/ajax/add-comment/' + id,
                    data: {
                        "content": $('#contentRate').val()
                    },
                    success: function (response) {

                        // Thêm HTML mới vào '.add-comment'
                        $('#commentBox').prepend('<div class="comment-item">\n' +
                            '   <div class="item-top">\n' +
                            '       <p class="txtname">' + response.user + '</p>\n' +
                            '   </div>\n' +
                            '</div>\n' +
                            '<div class="product-rating-time">' + response.created + '</div>\n' +
                            '<div class="comment-content">\n' +
                            '   <p class="cmt-txt">' + response.content + '</p>\n' +
                            '</div>\n' +
                            '<div class="item-click">\n' +
                            '   <a href="" class="clicklike">\n' +
                            '       <i class="fa fa-thumbs-up"></i>\n' +
                            '       Hữu ích\n' +
                            '   </a>\n' +
                            '   <a href="" class="clicklike">\n' +
                            '       <i class="fa fa-thumbs-down"></i>\n' +
                            '       Không hữu ích\n' +
                            '   </a>\n' +
                            '   <a href="" class="clicklike">\n' +
                            '       <i class="fa fa-envelope"></i>\n' +
                            '       Trả lời\n' +
                            '   </a>\n' +
                            '</div>');

                        // Reset giá trị của '#contentRate'
                        $('#contentRate').val('');
                        // }
                    },
                    error: function (response) {

                    }
                })
            }
        }
    </script>
</body>
</html>